# Usage Examples

This document provides practical examples of using kolja-aws, particularly focusing on the shell integration feature.

## Basic Workflow

### 1. Initial Setup

```bash
# Install kolja-aws
pip install kolja-aws

# Configure your first SSO session
kolja aws set my-company
# Enter SSO start URL: https://my-company.awsapps.com/start
# Enter SSO region: us-east-1

# Login to SSO
kolja aws login

# Generate AWS profiles
kolja aws profiles
```

### 2. Using Shell Integration

```bash
# Use the interactive profile switcher
sp

# Example output:
üîÑ AWS Profile Switcher
Use ‚Üë‚Üì arrow keys to navigate, Enter to select, Ctrl+C to cancel

? Select AWS Profile:
‚ùØ üü¢ 123456789012-AdminRole (current)
     123456789012-ReadOnlyRole  
     987654321098-DeveloperRole
     555666777888-DataScientistRole

# After selection:
‚úÖ Switched to profile: 123456789012-AdminRole

# Verify the switch
echo $AWS_PROFILE
# Output: 123456789012-AdminRole
```

## Advanced Usage Scenarios

### Multiple SSO Sessions

```bash
# Configure multiple SSO sessions for different organizations
kolja aws set company-prod
kolja aws set company-dev
kolja aws set client-org

# List all configured sessions
kolja aws get
# Output:
# Configured SSO sessions:
# - company-prod
# - company-dev  
# - client-org

# Login to all sessions
kolja aws login

# Generate profiles for all sessions
kolja aws profiles
```

### Shell Integration in Different Shells

#### Bash/Zsh Usage
```bash
# The sp function is automatically added to your shell
# Check if it's installed
type sp
# Output: sp is a function

# Use with command chaining
sp && aws s3 ls

# Use in scripts
#!/bin/bash
sp
if [ $? -eq 0 ]; then
    echo "Profile switched successfully"
    aws sts get-caller-identity
fi
```

#### Fish Shell Usage
```fish
# Fish shell function is automatically installed
# Use the same sp command
sp

# Use with Fish-specific syntax
sp; and aws s3 ls

# Check current profile in Fish
echo $AWS_PROFILE
```

### Integration with Development Workflows

#### Docker Development
```bash
# Switch to development profile
sp
# Select: 123456789012-DeveloperRole

# Run Docker container with AWS credentials
docker run -e AWS_PROFILE=$AWS_PROFILE \
           -v ~/.aws:/root/.aws:ro \
           my-app:latest
```

#### Terraform Workflows
```bash
# Switch to infrastructure profile
sp
# Select: 123456789012-InfrastructureRole

# Run Terraform with the selected profile
terraform plan
terraform apply
```

#### CI/CD Integration
```bash
# In your deployment script
#!/bin/bash
set -e

echo "Switching to production profile..."
# Note: In CI/CD, you'd typically use service accounts
# This is for local deployment scenarios
sp
# Select: 123456789012-ProductionRole

echo "Deploying application..."
aws s3 sync ./dist s3://my-app-bucket/
aws cloudfront create-invalidation --distribution-id ABCD123 --paths "/*"
```

## Troubleshooting Examples

### Manual Installation
```bash
# If automatic installation fails
kolja-install-shell

# Check installation
grep -n "kolja-aws profile switcher" ~/.bashrc
```

### Debugging Profile Issues
```bash
# Enable debug logging
export KOLJA_LOG_LEVEL=DEBUG

# Run profile switcher with debug info
sp

# Check AWS configuration
cat ~/.aws/config | grep -A 5 "\[profile"

# Verify profile manually
export AWS_PROFILE=123456789012-AdminRole
aws sts get-caller-identity
```

### Backup and Recovery
```bash
# List backup files
ls -la ~/.bashrc.backup.*

# Restore from backup if needed
cp ~/.bashrc.backup.20240108_120000 ~/.bashrc
source ~/.bashrc
```

## Integration with Other Tools

### AWS CLI
```bash
# Switch profile and use AWS CLI
sp
aws s3 ls
aws ec2 describe-instances
aws lambda list-functions
```

### Granted Integration
```bash
# kolja-aws profiles work with Granted
assume -c
# Shows the same profiles generated by kolja-aws

# Or use kolja-aws shell integration
sp
# Then use other AWS tools
```

### AWS Vault
```bash
# Generate profiles with kolja-aws
kolja aws profiles

# Use with aws-vault
aws-vault list
aws-vault exec 123456789012-AdminRole -- aws s3 ls
```

### IDE Integration

#### VS Code
```json
// In VS Code settings.json
{
    "aws.profile": "${env:AWS_PROFILE}",
    "terminal.integrated.env.osx": {
        "AWS_PROFILE": "${env:AWS_PROFILE}"
    }
}
```

#### IntelliJ/PyCharm
```bash
# Set environment variable in run configuration
# Environment variables: AWS_PROFILE=$AWS_PROFILE
```

## Scripting Examples

### Profile Switching Script
```bash
#!/bin/bash
# switch-and-deploy.sh

echo "Available profiles:"
aws configure list-profiles

echo "Switching profile..."
sp

if [ -n "$AWS_PROFILE" ]; then
    echo "Current profile: $AWS_PROFILE"
    echo "Account info:"
    aws sts get-caller-identity
    
    echo "Deploying..."
    # Your deployment commands here
else
    echo "No profile selected, exiting."
    exit 1
fi
```

### Multi-Account Operations
```bash
#!/bin/bash
# multi-account-check.sh

PROFILES=("123456789012-AdminRole" "987654321098-ReadOnlyRole")

for profile in "${PROFILES[@]}"; do
    echo "Checking account: $profile"
    export AWS_PROFILE=$profile
    
    echo "Account ID: $(aws sts get-caller-identity --query Account --output text)"
    echo "S3 Buckets: $(aws s3 ls | wc -l)"
    echo "---"
done
```

### Automated Profile Generation
```bash
#!/bin/bash
# refresh-profiles.sh

echo "Refreshing SSO sessions..."
kolja aws login

echo "Regenerating profiles..."
kolja aws profiles

echo "Available profiles:"
aws configure list-profiles | grep -E "^[0-9]+-"

echo "Shell integration ready!"
```

## Best Practices

### Daily Development Workflow
```bash
# Morning routine
kolja aws login  # Refresh SSO sessions
sp               # Switch to development profile

# Work on project
git pull
# ... development work ...

# Switch to staging for testing
sp               # Select staging profile
# ... testing ...

# Switch to production for deployment
sp               # Select production profile
# ... deployment ...
```

### Team Collaboration
```bash
# Share profile naming conventions
# Use consistent format: AccountID-RoleName
# Examples:
# - 123456789012-DeveloperRole
# - 123456789012-AdminRole
# - 987654321098-ReadOnlyRole

# Document SSO URLs for team
# Create team documentation with SSO start URLs
# Each team member runs:
kolja aws set team-dev
kolja aws set team-prod
```

### Security Best Practices
```bash
# Regular session refresh
kolja aws login  # Run daily or as needed

# Verify current profile before sensitive operations
echo "Current profile: $AWS_PROFILE"
aws sts get-caller-identity

# Use least privilege profiles
sp  # Select appropriate role for the task
```

## Performance Tips

### Fast Profile Switching
```bash
# The sp command is optimized for speed
# Profiles are cached and loaded quickly
time sp  # Usually completes in < 1 second
```

### Batch Operations
```bash
# For multiple AWS operations, switch once
sp  # Select profile once
aws s3 ls
aws ec2 describe-instances  
aws lambda list-functions
# All use the same profile
```

### Shell Optimization
```bash
# Add to your shell configuration for faster startup
# Only load kolja-aws functions when needed
alias sp-reload='source ~/.bashrc'
```

These examples demonstrate the flexibility and power of kolja-aws shell integration in various development scenarios.